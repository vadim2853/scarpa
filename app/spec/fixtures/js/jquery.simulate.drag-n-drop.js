!function(e,t){"use strict";function a(t){return p.test(Object.prototype.toString.call(e(t)[0]))}function r(t,a){var r;if(e.isFunction(a)){for(r=0;r<t.length;r+=1)if(a(t[r]))return t[r];return null}for(r=0;r<t.length;r+=1)if(t[r])return t[r];return null}function n(t){var r,n=e(t);return r=a(n[0])?{left:0,top:0}:n.offset(),{x:r.left+n.outerWidth()/2,y:r.top+n.outerHeight()/2}}function o(t,r,n){var o;return o=e(a(r)?r:n||document),"number"==typeof t&&"number"==typeof r?{x:t-o.scrollLeft(),y:r-o.scrollTop()}:"object"==typeof t&&t.pageX&&t.pageY?{clientX:t.pageX-o.scrollLeft(),clientY:t.pageY-o.scrollTop()}:void 0}function i(t,r,n){var o;if(o=a(r)?r:n||document,!o.elementFromPoint)return null;var s=t,l=r;if("object"==typeof t&&(t.clientX||t.clientY)&&(s=t.clientX||0,l=t.clientY||0),i.prototype.check){var u,p;(u=e(o).scrollTop())>0?(p=o.elementFromPoint(0,u+e(window).height()-1),null!==p&&"HTML"===p.tagName.toUpperCase()&&(p=null),i.prototype.nativeUsesRelative=null===p):(u=e(o).scrollLeft())>0&&(p=o.elementFromPoint(u+e(window).width()-1,0),null!==p&&"HTML"===p.tagName.toUpperCase()&&(p=null),i.prototype.nativeUsesRelative=null===p),i.prototype.check=0>=u}return i.prototype.nativeUsesRelative||(s+=e(o).scrollLeft(),l+=e(o).scrollTop()),o.elementFromPoint(s,l)}function s(t,a){var r=a||{};e(t).trigger({type:"simulate-drag"}),e.isFunction(r.callback)&&r.callback.apply(t)}function l(t,n,l,p,c){function d(){T.x+=h.x,T.y+=h.y;var e={pageX:T.x,pageY:T.y};if(f.shaky&&(f.shaky===!0||!isNaN(parseInt(f.shaky,10)))){var a=f.shaky===!0?1:parseInt(f.shaky,10);e.pageX+=Math.floor(Math.random()*(2*a+1)-a),e.pageY+=Math.floor(Math.random()*(2*a+1)-a)}var r=o(e,y),s=i(r,y)||n;t.simulateEvent(s,"mousemove",{pageX:Math.round(e.pageX),pageY:Math.round(e.pageY)})}function g(){var e=u()-M;if(e>=X)if(v>Y)d(),Y+=1,M=u(),setTimeout(g,X);else{var a={pageX:Math.round(l.x+p.dx),pageY:Math.round(l.y+p.dy)},r=o(a,y),m=i(r,y)||n;t.simulateEvent(m,"mousemove",a),s(n,c)}else setTimeout(g,X-e)}var m,v,h,y=r([n,n.ownerDocument],a)||document,f=c.interpolation,D=Math.sqrt(Math.pow(p.dx,2)+Math.pow(p.dy,2));if(f.stepWidth){m=parseInt(f.stepWidth,10),v=Math.floor(D/m)-1;var x=m/D;h={x:p.dx*x,y:p.dy*x}}else v=parseInt(f.stepCount,10),m=D/(v+1),h={x:p.dx/(v+1),y:p.dy/(v+1)};var M,T=e.extend({},l);if(!f.stepDelay&&!f.duration||f.stepDelay<=0&&f.duration<=0){for(var k=0;v>k;k+=1)d();var w={pageX:Math.round(l.x+p.dx),pageY:Math.round(l.y+p.dy)},E=o(w,y),P=i(E,y)||n;t.simulateEvent(P,"mousemove",w),s(n,c)}else{var X=parseInt(f.stepDelay,10)||Math.ceil(parseInt(f.duration,10)/(v+1)),Y=0;M=u(),setTimeout(g,X)}}e.fn.simulate=function(t,a){switch(t){case"drag":case"drop":case"drag-n-drop":var r=this.first();return new e.simulate(r[0],t,a),r;default:return this.each(function(){new e.simulate(this,t,a)})}};var u=Date.now||function(){return(new Date).getTime()},p=/\[object (?:HTML)?Document\]/;i.prototype.check=!0,i.prototype.nativeUsesRelative=!0,e.simulate.activeDrag=function(){return e.simulate._activeDrag?e.extend(!0,{},e.simulate._activeDrag):t},e.extend(e.simulate.prototype,{simulateDrag:function(){var u,p=this,c=p.target,d=e.extend({dx:0,dy:0,dragTarget:t,clickToDrag:!1,eventProps:{},interpolation:{stepWidth:0,stepCount:0,stepDelay:0,duration:0,shaky:!1},callback:t},this.options),g=e.simulate._activeDrag&&e.simulate._activeDrag.dragElement===c;u=g?e.simulate._activeDrag.dragStart:n(c);var m,v,h=Math.round(u.x),y=Math.round(u.y),f={pageX:h,pageY:y};if(d.dragTarget){var D=n(d.dragTarget);m=Math.round(D.x-u.x),v=Math.round(D.y-u.y)}else m=d.dx||0,v=d.dy||0;if(g?(e.simulate._activeDrag.dragDistance.x+=m,e.simulate._activeDrag.dragDistance.y+=v,f={pageX:Math.round(h+e.simulate._activeDrag.dragDistance.x),pageY:Math.round(y+e.simulate._activeDrag.dragDistance.y)}):(e.simulate._activeDrag&&e(e.simulate._activeDrag.dragElement).simulate("drop"),e.extend(d.eventProps,f),p.simulateEvent(c,"mousedown",d.eventProps),d.clickToDrag===!0&&(p.simulateEvent(c,"mouseup",d.eventProps),p.simulateEvent(c,"click",d.eventProps)),e(c).add(c.ownerDocument).one("mouseup",function(){e.simulate._activeDrag=t}),e.extend(e.simulate,{_activeDrag:{dragElement:c,dragStart:{x:h,y:y},dragDistance:{x:m,y:v}}}),f={pageX:Math.round(h+m),pageY:Math.round(y+v)}),0!==m||0!==v)if(d.interpolation&&(d.interpolation.stepCount||d.interpolation.stepWidth))l(p,c,{x:h,y:y},{dx:m,dy:v},d);else{var x=r([c,c.ownerDocument],a)||document,M=o(f,x),T=i(M,x)||c;e.extend(d.eventProps,f),p.simulateEvent(T,"mousemove",d.eventProps),s(c,d)}else s(c,d)},simulateDrop:function(){var s=this,l=this.target,u=e.simulate._activeDrag,p=e.extend({clickToDrop:!1,eventProps:{},callback:t},s.options),c=!0,d=n(l),g=Math.round(d.x),m=Math.round(d.y),v={pageX:g,pageY:m},h=(u?r([u.dragElement,u.dragElement.ownerDocument],a):r([l,l.ownerDocument],a))||document,y=o(v,h),f=i(y,h);u&&(u.dragElement===l||a(l))&&(g=Math.round(u.dragStart.x+u.dragDistance.x),m=Math.round(u.dragStart.y+u.dragDistance.y),v={pageX:g,pageY:m},y=o(v,h),f=i(y,h),c=!1),f||(f=u?u.dragElement:l),e.extend(p.eventProps,v),c===!0&&s.simulateEvent(f,"mousemove",p.eventProps),p.clickToDrop&&s.simulateEvent(f,"mousedown",p.eventProps),this.simulateEvent(f,"mouseup",p.eventProps),p.clickToDrop&&s.simulateEvent(f,"click",p.eventProps),e.simulate._activeDrag=t,e(f).trigger({type:"simulate-drop"}),e.isFunction(p.callback)&&p.callback.apply(f)},simulateDragNDrop:function(){var a=this,r=this.target,n=e.extend({dragTarget:t,dropTarget:t},a.options),o=(n.dragTarget||n.dx||n.dy?n.dropTarget:r)||r;e(r).simulate("drag",e.extend({},n,{dragTarget:n.dragTarget||(n.dx||n.dy?t:n.dropTarget),callback:function(){e(o).simulate("drop",n)}}))}})}(jQuery);
